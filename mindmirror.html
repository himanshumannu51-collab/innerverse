<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MindMirror ‚Äì InnerVerse OS</title>
<style>
  body {
    background: radial-gradient(circle at top left, #0b1222, #000);
    color: #e2e8f0;
    font-family: sans-serif;
    text-align: center;
    padding: 2em;
  }
  button {
    padding: 10px 16px;
    border: none;
    border-radius: 6px;
    margin: 6px;
    cursor: pointer;
  }
  #start { background: #4f46e5; color: #fff; }
  #stop { background: #ef4444; color: #fff; }
  #output { margin-top: 1.5em; text-align: left; max-width: 600px; margin-inline: auto; }
  pre { background: #111827; padding: 1em; border-radius: 8px; color: #cbd5e1; overflow-x: auto; }
</style>
</head>
<body>

<h1>üß† MindMirror</h1>
<p>Record your voice ‚Üí AI reflects your emotion & gives one-line insight.</p>

<div>
  <button id="start">Start Recording</button>
  <button id="stop" disabled>Stop</button>
</div>

<div id="output">
  <h3>Transcript</h3>
  <pre id="transcript">(none yet)</pre>
  <h3>AI Insight</h3>
  <pre id="insight">(waiting...)</pre>
</div>

<script>
let chunks = [], recorder;
const t = document.getElementById('transcript');
const i = document.getElementById('insight');

document.getElementById('start').onclick = async () => {
  chunks = [];
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  recorder = new MediaRecorder(stream);
  recorder.ondataavailable = e => chunks.push(e.data);
  recorder.onstop = sendAudio;
  recorder.start();
  document.getElementById('start').disabled = true;
  document.getElementById('stop').disabled = false;
};

document.getElementById('stop').onclick = () => {
  recorder.stop();
  document.getElementById('start').disabled = false;
  document.getElementById('stop').disabled = true;
};

async function sendAudio() {
  t.textContent = 'Transcribing...';
  i.textContent = 'Analyzing...';
  const blob = new Blob(chunks, { type: 'audio/webm' });
  const fd = new FormData();
  fd.append('file', blob, 'audio.webm');

  try {
    const res = await fetch('/api/mindmirror', { method: 'POST', body: fd });
    const data = await res.json();
    t.textContent = data.transcript || '(no text)';
    i.textContent = data.insight || '(no insight)';
  } catch (err) {
    i.textContent = '‚ùå Error connecting to server.';
  }
}
</script>

</body>
</html>
